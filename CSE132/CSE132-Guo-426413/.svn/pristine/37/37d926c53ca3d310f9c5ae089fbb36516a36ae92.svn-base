package lab4.client;

import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.IOException;
import java.net.Socket;
import java.net.UnknownHostException;
import java.util.ArrayList;
import java.util.Map;

import javax.swing.JList;

/**
 *  Client
 *   Remote network view for a Weasley Clock.
 *
 *  Author: COMPLETE THIS
 *  Course: CS132
 *  Lab:    4
 *  
 */

public class Client {
	// Complete the Client class
	Socket client;
	DataInputStream dis;
	DataOutputStream dos;
	//ArrayList<String> names;
	public Client() {
		try {
			client = new Socket("localhost", 10400);
			dis = new DataInputStream(client.getInputStream());
			dos = new DataOutputStream(client.getOutputStream());
			//names = new ArrayList<String>();
		} catch (UnknownHostException e) {
			System.out.println("Don't know this host");
			e.printStackTrace();
		} catch (IOException e) {
			System.out.println("can not get io connection");
			e.printStackTrace();
		}
	}

	public void runPeople() {
		try {
			//System.out.println("run client!!!!");
			int size;
			String reply;
			dos.writeUTF("people");
			//dos.writeUTF("query alice");
			size = dis.readInt();
			//names.clear();
			for (int i = 0; i < size; i++) {
				reply = dis.readUTF();
				System.out.print(reply + "  ");
			}
			System.out.println();

		} catch (IOException e) {
			e.printStackTrace();
		} 
	}

	public void runLocation() {
		try {
			//System.out.println("run client!!!!");
			int size;
			String reply;
			dos.writeUTF("locations");
			size = dis.readInt();
			for (int i = 0; i < size; i++) {
				reply = dis.readUTF();
				System.out.print(reply + "  ");
			}
			System.out.println();
		} catch (IOException e) {
			e.printStackTrace();
		} 
	}

	public void run(ArrayList<String> names, Map<String, String> info, JList people) {

		try {
			//System.out.println("run client!!!!");
			int size;
			String reply;
			dos.writeUTF("people");
			size = dis.readInt();
			names.clear();
			for (int i = 0; i < size; i++) {
				reply = dis.readUTF();
				names.add(reply);
				//System.out.print(reply + "  ");
			}
			people.setListData(names.toArray());
			//System.out.println();
			
			while (true) {
				info.clear();
				for (String name : names) {
					String query = "query " + name;
					dos.writeUTF(query);
					size = dis.readInt();
					reply = dis.readUTF();
					info.put(name, reply);
					//System.out.println("name: " + name + "  location: " + reply);
				}
				Thread.sleep(500);
			}
			
		} catch (IOException e) {
			e.printStackTrace();
		} catch (InterruptedException e) {
			e.printStackTrace();
		} 

	}


	/**
	 * Entry point for lab4 client.
	 * @param args unused
	 */
	public static void main(String[] args) {
		System.out.println("client executing");
		Client c = new Client();
		//c.run();
	}

}
